<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hill Climb Endless Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
  <style>
    body { margin: 0; background: #87ceeb; overflow: hidden; }
    canvas { display: block; margin: 0 auto; }
  </style>
</head>
<body>

<script>
  const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 400,
    physics: {
      default: 'arcade',
      arcade: {
        gravity: { y: 500 },
        debug: false
      }
    },
    scene: {
      preload: preload,
      create: create,
      update: update
    }
  };

  const game = new Phaser.Game(config);

  let car, cursors, groundGroup, camera;

  function preload() {
    this.load.image('ground', 'https://labs.phaser.io/assets/sprites/platform.png');
    this.load.image('car', 'https://labs.phaser.io/assets/sprites/car.png');
  }

  function create() {
    groundGroup = this.physics.add.staticGroup();
    for (let i = 0; i < 20; i++) {
      groundGroup.create(i * 128, 368, 'ground').setScale(0.5).refreshBody();
    }

    car = this.physics.add.sprite(100, 300, 'car').setScale(0.5);
    car.setBounce(0.2);
    car.setCollideWorldBounds(false);

    this.physics.add.collider(car, groundGroup);

    cursors = this.input.keyboard.createCursorKeys();

    camera = this.cameras.main;
    camera.startFollow(car);
  }

  function update() {
    if (cursors.left.isDown) {
      car.setVelocityX(-160);
    } else if (cursors.right.isDown) {
      car.setVelocityX(160);
    } else {
      car.setVelocityX(0);
    }

    if (cursors.up.isDown && car.body.touching.down) {
      car.setVelocityY(-300);
    }

    // Add new ground blocks ahead
    let farthest = 0;
    groundGroup.getChildren().forEach(function (block) {
      if (block.x > farthest) {
        farthest = block.x;
      }
    });

    if (car.x > farthest - 512) {
      let newBlock = groundGroup.create(farthest + 128, 368, 'ground').setScale(0.5).refreshBody();
    }

    // Remove blocks that are too far behind
    groundGroup.getChildren().forEach(function (block) {
      if (block.x < car.x - 512) {
        groundGroup.remove(block, true, true);
      }
    });
  }
</script>

</body>
</html>
